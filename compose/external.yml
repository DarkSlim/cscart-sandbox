version: '3'
services:

  nginx56:
    environment:
      DOMAIN: ${DOMAIN}
      CSCART_ADDRESS: ${PHP56_ADDRESS}
    volumes:
      - ${CSCART_VOLUMES}/ssl:/etc/nginx/ssl

    ################################################################################

  nginx70:
    environment:
      DOMAIN: ${DOMAIN}
      CSCART_ADDRESS: ${PHP70_ADDRESS}
    volumes:
      - ${CSCART_VOLUMES}/ssl:/etc/nginx/ssl

    ################################################################################

  nginx71:
    environment:
      DOMAIN: ${DOMAIN}
      CSCART_ADDRESS: ${PHP71_ADDRESS}
    volumes:
      - ${CSCART_VOLUMES}/ssl:/etc/nginx/ssl

    ################################################################################

  nginx72:
    environment:
      DOMAIN: ${DOMAIN}
      CSCART_ADDRESS: ${PHP72_ADDRESS}
    volumes:
      - ${CSCART_VOLUMES}/ssl:/etc/nginx/ssl

################################################################################

  proxy:
    command: /bin/sh -c "envsubst '$${PHP72_ADDRESS},$${PHP71_ADDRESS},$${PHP70_ADDRESS},$${PHP56_ADDRESS},$${DOMAIN}' < /etc/nginx/templates/proxy.dist > /etc/nginx/conf.d/proxy.conf && cp -f /etc/nginx/templates/*.conf /etc/nginx/xtra/ && nginx-debug -g 'daemon off;'"
    environment:
      DOMAIN: ${DOMAIN}
      PHP72_ADDRESS: ${PHP72_ADDRESS}
      PHP71_ADDRESS: ${PHP71_ADDRESS}
      PHP70_ADDRESS: ${PHP70_ADDRESS}
      PHP56_ADDRESS: ${PHP56_ADDRESS}
    volumes:
      - ${CSCART_VOLUMES}/acme:/acme.sh:rw
      - ${CSCART_VOLUMES}/ssl:/etc/nginx/ssl

################################################################################